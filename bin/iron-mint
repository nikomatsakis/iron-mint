#!/bin/bash
# Iron Mint CLI

set -e

IRON_MINT_DIR="$HOME/dev/iron-mint"

show_help() {
    cat << 'EOF'
iron-mint - Personal development environment setup

Usage: iron-mint <command>

Commands:
    setup       Run full setup (install tools, configure shell & git)
    sync        Sync configuration only (shell & git, no tool installation)
    gitignore   Edit global gitignore patterns (auto-syncs after saving)
    uninstall   Restore original configuration from backups

Options:
    -h, --help  Show this help message

Examples:
    iron-mint setup      # Full setup including tool installation
    iron-mint sync       # Just sync config changes (e.g., after editing gitignore-global)
EOF
}

cmd_setup() {
    exec "$IRON_MINT_DIR/setup.sh"
}

cmd_sync() {
    echo "ðŸ”„ Syncing Iron Mint configuration..."
    "$IRON_MINT_DIR/scripts/configure-shell.sh"
    "$IRON_MINT_DIR/scripts/configure-git.sh"
    echo "âœ… Configuration synced"
}

cmd_gitignore() {
    local pattern="$1"
    if [ -n "$pattern" ]; then
        echo "$pattern" >> "$IRON_MINT_DIR/config/gitignore-global"
        echo "Added: $pattern"
    else
        ${EDITOR:-vim} "$IRON_MINT_DIR/config/gitignore-global"
    fi
    echo "ðŸ”„ Syncing gitignore..."
    "$IRON_MINT_DIR/scripts/configure-git.sh" 2>&1 | grep -E "(gitignore|excludesfile)"
    echo "âœ… Done"
}

cmd_uninstall() {
    exec "$IRON_MINT_DIR/uninstall.sh"
}

# Main
case "${1:-}" in
    setup)
        cmd_setup
        ;;
    sync)
        cmd_sync
        ;;
    gitignore)
        cmd_gitignore "$2"
        ;;
    uninstall)
        cmd_uninstall
        ;;
    -h|--help|"")
        show_help
        ;;
    *)
        echo "Unknown command: $1"
        echo "Run 'iron-mint --help' for usage"
        exit 1
        ;;
esac
