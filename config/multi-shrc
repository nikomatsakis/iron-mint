# Iron Mint Shell Configuration
# This file is sourced by ~/.zshrc or ~/.bashrc when Iron Mint is installed
# Works with both zsh and bash by detecting shell type at runtime

# Detect shell type
if [ -n "$ZSH_VERSION" ]; then
    # Zsh configuration

    # Enable vim keybindings
    bindkey -v

    # Better history search with vim keys
    bindkey -M vicmd 'k' history-beginning-search-backward
    bindkey -M vicmd 'j' history-beginning-search-forward

    # Quick escape to normal mode
    bindkey -M viins 'jk' vi-cmd-mode

    # Better vim mode cursor
    function zle-keymap-select {
      if [[ $KEYMAP == vicmd ]] || [[ $1 = 'block' ]]; then
        echo -ne '\e[1 q'  # Block cursor
      elif [[ $KEYMAP == main ]] || [[ $KEYMAP == viins ]] || [[ $1 = 'beam' ]]; then
        echo -ne '\e[5 q'  # Beam cursor
      fi
    }
    zle -N zle-keymap-select

    # Initialize cursor
    echo -ne '\e[5 q'

    # Bold hostname prompt
    PROMPT='%B%m.%b '

    # Enhanced history settings
    HISTSIZE=10000
    SAVEHIST=10000
    setopt HIST_IGNORE_DUPS
    setopt HIST_IGNORE_SPACE
    setopt SHARE_HISTORY

elif [ -n "$BASH_VERSION" ]; then
    # Bash configuration

    # Enable vi mode
    set -o vi

    # Bold hostname prompt
    PS1='\[\e[1m\]\h.\[\e[0m\] '

    # Enhanced history settings
    HISTSIZE=10000
    HISTFILESIZE=10000
    HISTCONTROL=ignoredups:ignorespace
    shopt -s histappend
fi

# Common configuration for both shells

# Cargo (Rust) - add to PATH if installed
if [ -d "$HOME/.cargo/bin" ]; then
    export PATH="$HOME/.cargo/bin:$PATH"
fi

# Volta (Node.js) - initialize if installed
if [ -d "$HOME/.volta" ]; then
    export VOLTA_HOME="$HOME/.volta"
    export PATH="$VOLTA_HOME/bin:$PATH"
fi

# Iron Mint bin directory (for helper scripts like git-editor)
if [ -d "$HOME/dev/iron-mint/bin" ]; then
    export PATH="$HOME/dev/iron-mint/bin:$PATH"
fi

# Direnv - directory-based environment management
if command -v direnv &> /dev/null; then
    if [ -n "$ZSH_VERSION" ]; then
        eval "$(direnv hook zsh)"
    elif [ -n "$BASH_VERSION" ]; then
        eval "$(direnv hook bash)"
    fi
fi
